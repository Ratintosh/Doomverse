<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>My Electron Frameless Window</title>
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="wizard.css">
</head>

<body class="wizardContent">
    <div class="titleStuffs" id="title-bar">
        <div id="title">

        </div>
        <br>
        <div class="navBar">
            <div id="generalTab" class="navBarElement selected">
                <object id="generalIcon" data="icons/wizard/gear.svg" type="image/svg+xml"></object>
                <p>General</p>
            </div>
            <div id="videoTab" class="navBarElement">
                <object id="videoIcon" data="icons/wizard/video.svg" type="image/svg+xml"></object>
                <p>Video</p>
            </div>
            <div id="audioTab" class="navBarElement">
                <object id="audioIcon" data="icons/wizard/audio.svg" type="image/svg+xml"></object>
                <p>Audio</p>
            </div>
            <div id="gameplayTab" class="navBarElement">
                <object id="gameplayIcon" data="icons/wizard/gameplay.svg" type="image/svg+xml"></object>
                <p>Gameplay</p>
            </div>
            <div id="advancedTab" class="navBarElement">
                <object id="advancedIcon" data="icons/wizard/advanced.svg" type="image/svg+xml"></object>
                <p>Advanced</p>
            </div>
        </div>
        <div id="title-bar-btns">

            <a id="close-btn" href="#"><svg class="ctrl" xmlns="http://www.w3.org/2000/svg" width="18px" height="18px"
                    viewBox="0 0 24 24" fill="none" stroke="#4f4f4f" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" class="feather feather-x">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg></a>
        </div>
    </div>
    <div class="wizard">
        <div class="wizardBody">
            <div id="generalBody" style="display: block;">
                <h1>General</h1>
                <p>Configure information</p>
                <div class="panel">
                    <div class="inputRow">
                        <div>
                            <p>Name</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input value="Doom 2" id="gameTitle">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Author</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input value="ID Software" id="gameAuthor">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Year</p>
                            <p class="subtext">(Optional)</p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input value="1996" id="gameYear">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Base Game</p>
                            <p class="subtext">(Optional)</p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <select name="-iwad" id="-iwad">
                                <option value="doom.wad">Doom 1 (Not Found)</option>
                                <option value="doom2.wad">Doom 2 (Not Found)</option>
                                <option value="custom">Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Source Port</p>
                            <p class="subtext">If your desired source port isn't showing up, make sure it is installed properly.</p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <select name="sourceport" id="sourceport">
                                <option value="gzdoom">GZDoom</option>
                                <option value="prboom">PrBoom+</option>
                                <option value="chocolatedoom">Chocolate Doom</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="videoBody" style="display: none;">
                <h1>Video</h1>
                <p>Configure video settings</p>
                <div class="panel">
                    <div class="inputRow">
                        <div>
                            <p>Launch Fullscreen</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="+fullscreen" name="+fullscreen">
                        </div>
                    </div>
                    
                    <div class="inputRow">
                        <div>
                            <p>Render Mode</p>
                            <p class="subtext">Chooses which rendering API to use. If unsure, use OpenGL</p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <select name="+vid_rendermode" id="+vid_rendermode">
                                <option value="r_opengl">OpenGL</option>
                                <option value="r_vulkan">Vulkan</option>
                                <option value="r_software">Software</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div id="audioBody" style="display: none;">
                <h1>Audio</h1>
                <p>Configure audio settings</p>
                <div class="panel">
                    <div class="inputRow">
                        <div>
                            <p>Disable All Sounds</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="-nosound" name="-nosound" value="-nosound">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Disable Sound Effects</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="-nosfx" name="-nosfx" value="-nosfx">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Disable Music</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="-nomusic" name="-nomusic" value="-nomusic">
                        </div>
                    </div>
                </div>
            </div>

            <div id="gameplayBody" style="display: none;">
                <h1>Gameplay</h1>
                <p>Configure gameplay flags</p>
                <div class="panel">
                    <div class="inputRow">
                        <div>
                            <p>Disable Monsters</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="-nomonsters" name="-nomonsters">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Fast Monsters</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="-fast" name="-fast">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Respawning Monsters</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input type="checkbox" id="-respawn" name="-respawn">
                        </div>
                    </div>
                </div>
            </div>

            <div id="advancedBody" style="display: none;">
                <h1>Advanced</h1>
                <p>Add custom launch args</p>
                <div class="panel">
                    <div class="inputRow">
                        <div>
                            <p>Name</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input value="Doom 2" id="gameTitle">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Author</p>
                            <p class="subtext"></p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input value="ID Software" id="gameTitle">
                        </div>
                    </div>
                    <div class="inputRow">
                        <div>
                            <p>Year</p>
                            <p class="subtext">(Optional)</p>
                        </div>
                        <div style="padding:0; margin:0;">
                            <input value="1996" id="gameTitle">
                        </div>
                    </div>
                </div>
            </div>


        </div>
    <button id="submitConfig">Submit</button>
    </div>
    <script>
        (function () {
            // Retrieve remote BrowserWindow
            const { ipcRenderer } = require('electron');
            var screen = 0
            function clearNavBar() {
                //remove selected from all elements
                document.getElementById("generalTab").classList.remove("selected")
                document.getElementById("videoTab").classList.remove("selected")
                document.getElementById("audioTab").classList.remove("selected")
                document.getElementById("gameplayTab").classList.remove("selected")
                document.getElementById("advancedTab").classList.remove("selected")

                //remove selected from all icons
                document.getElementById("generalIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.remove("selected")
                document.getElementById("videoIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.remove("selected")
                document.getElementById("audioIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.remove("selected")
                document.getElementById("gameplayIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.remove("selected")
                document.getElementById("advancedIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.remove("selected")
            }
            function clearPage(){
                document.getElementById("generalBody").style.display = "none"
                document.getElementById("videoBody").style.display = "none"
                document.getElementById("audioBody").style.display = "none"
                document.getElementById("gameplayBody").style.display = "none"
                document.getElementById("advancedBody").style.display = "none"
            }
            function init() {
                
                document.getElementById("submitConfig").addEventListener("click", (e) => {
                   appendData()
                   window.close()
                });

                document.getElementById("close-btn").addEventListener("click", (e) => {
                    window.close()
                });

                //handle tabs
                document.getElementById("generalTab").addEventListener("click", (e) => {
                    clearNavBar()
                    clearPage()
                    document.getElementById("generalBody").style.display = "block"
                    //add it back to the chosen one
                    document.getElementById("generalTab").classList.add("selected")
                    document.getElementById("generalIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.add("selected")
                })
                document.getElementById("videoTab").addEventListener("click", (e) => {
                    clearNavBar()
                    clearPage()
                    document.getElementById("videoBody").style.display = "block"
                    //add it back to the chosen one
                    document.getElementById("videoTab").classList.add("selected")
                    document.getElementById("videoIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.add("selected")
                })
                document.getElementById("audioTab").addEventListener("click", (e) => {
                    clearNavBar()
                    clearPage()
                    document.getElementById("audioBody").style.display = "block"
                    //add it back to the chosen one
                    document.getElementById("audioTab").classList.add("selected")
                    document.getElementById("audioIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.add("selected")
                })
                document.getElementById("gameplayTab").addEventListener("click", (e) => {
                    clearNavBar()
                    clearPage()
                    document.getElementById("gameplayBody").style.display = "block"
                    //add it back to the chosen one
                    document.getElementById("gameplayTab").classList.add("selected")
                    document.getElementById("gameplayIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.add("selected")
                })
                document.getElementById("advancedTab").addEventListener("click", (e) => {
                    clearNavBar()
                    clearPage()
                    document.getElementById("advancedBody").style.display = "block"
                    //add it back to the chosen one
                    document.getElementById("advancedTab").classList.add("selected")
                    document.getElementById("advancedIcon").getSVGDocument().querySelectorAll(".navIcon")[0].classList.add("selected")
                })
            };
            function appendData() {
                //when the submit button is clicked on the iwad wizard screen, it calls this function which creates a tmp json object w/ null values for everything.
                //this function then goes one by one filling in information from the form.
                var tmp = {
                    "metadata": {
                        "name": "null",
                        "author": "null",
                        "year": "null",
                        "grid": "null"
                    },
                    "game": {
                        "sourceport": "null",
                        "-iwad": "null",
                        "modded": "null",
                        "mods": {},
                        "-config": "null"
                    },

                    "opts": {

                        "enableSounds": "null",
                        "-nosound": "null",

                        "-nosfx": "null",
                        "-nomusic": "null",


                        "-nomonsters": "null",
                        "-fast": "null",
                        "-respawn": "null",

                        "-width": "null",
                        "-height": "null",
                        "+fullscreen": "null",
                        "+vid_rendermode": "null",

                        "custom": "null",
                        "jumpFlags": {
                            "enabled": "null",
                            "-map": "null",
                            "-skill": "null"
                        }
                    }

                }
                //so i made the opts not nested. basically you can access all the options through the opts object without having to go down an extra object depending on what the options were related to.
                //this helps to mitigate issues i encountered trying to parse this recursively.
                //tmp = tmp["TEST"]
                console.log(tmp)
                tmp["metadata"]["name"] = document.getElementById("gameTitle").value;
                tmp["metadata"]["author"] = document.getElementById("gameAuthor").value;
                tmp["metadata"]["year"] = document.getElementById("gameYear").value;
                tmp["metadata"]["grid"] = "thumbs/unkown.jpg"

                //get all inputs (it's missing the metadata info, because the title, year, and author uses span)
                //also there are <select> tags for things like the dropdowns. Gotta add that in too.
                var opts = document.querySelectorAll("input, select, span")


                opts.forEach((element) => {
                    if (element.type == "checkbox") {
                        //these would be checkboxes for flags such as nomonsters and nosfx.
                        if (element.checked) {
                            if (tmp["opts"][element.id.toString()]) { //check to make sure the flags even exist. they should but this is a failsafe.i
                                //set the flags to true
                                tmp["opts"][element.id.toString()] = true


                            } else {
                                if (element.id.toString() == "jump") {
                                    //fill out the configuration data for when the user wants to jump to a certain map

                                    tmp["opts"]["jumpFlags"]["enabled"] = true
                                    tmp["opts"]["jumpFlags"]["-map"] = document.getElementById("-map").value
                                    tmp["opts"]["jumpFlags"]["-skill"] = document.getElementById("-skill").value

                                } else {
                                    console.log(tmp["opts"][element.id.toString()])
                                    console.log("Uh oh. Cannot find " + element.id + " in the config.")
                                }
                            }
                        }
                    }
                    if (element.type == "text") {
                        //these would be text boxes, usually 
                        if (element.value != "") {
                            if (tmp["opts"][element.id.toString()]) {
                                tmp["opts"][element.id.toString()] = element.value
                            } else {
                                //console.log("Uh oh. Cannot find " + element.id + " in the config.")
                            }
                            console.log(element.id + " " + element.value)
                        } else {
                            console.log("Nothing here... skipping")
                        }
                    }
                    if (element.type == "radio") {
                        console.log("Idk what  to do here.")
                    }
                    if (element.type == "select-one") {
                        //these would be text boxes, usually 
                        if (element.id == "sourceport") {
                            tmp["game"]["sourceport"] = element.value
                        }
                        if (element.id == "-iwad") {
                            tmp["game"]["-iwad"] = element.value
                        }
                    }
                })

                console.log(tmp)
                ipcRenderer.send('addGame', tmp)
            }

            document.onreadystatechange = () => {
                if (document.readyState == "complete") {
                    init();
                }
            };
        })();
    </script>
</body>

</html>